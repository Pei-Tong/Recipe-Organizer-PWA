let e,t,r;function i(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}var n=globalThis,o={},a={},l=n.parcelRequire94c2;null==l&&((l=function(e){if(e in o)return o[e].exports;if(e in a){var t=a[e];delete a[e];var r={id:e,exports:{}};return o[e]=r,t.call(r.exports,r,r.exports),r.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){a[e]=t},n.parcelRequire94c2=l);var c=l.register;c("27Lyk",function(e,t){i(e.exports,"register",()=>r,e=>r=e),i(e.exports,"resolve",()=>n,e=>n=e);var r,n,o=new Map;r=function(e,t){for(var r=0;r<t.length-1;r+=2)o.set(t[r],{baseUrl:e,path:t[r+1]})},n=function(e){var t=o.get(e);if(null==t)throw Error("Could not resolve bundle with id "+e);return new URL(t.path,t.baseUrl).toString()}}),c("jOsMR",function(e,t){var r=l("Gr8vk");e.exports=r("k5KBG").then(()=>l("lR3v8"))}),c("Gr8vk",function(e,t){e.exports=function(e){return import(l("27Lyk").resolve(e))}}),l("27Lyk").register(new URL("",import.meta.url).toString(),JSON.parse('["iOmLm","recipes.e7672a28.js","k5KBG","loglevel.2daa5c96.js","22JMF","index.20e66b64.js","nZBkt","index.95099fc4.js","8CGZa","index_0.22e893d8.js"]'));var d=l("47Mwn"),s=l("j3my9");try{l("jOsMR").then(t=>{(e=t.default).setLevel("info"),e.info("Recipes script started")}).catch(t=>{console.error("Failed to load loglevel:",t),e=console,console.info("Recipes script started (using console as fallback)")})}catch(t){console.error("Error initializing loglevel:",t),e=console}const p=document.getElementById("recipeName"),u=document.getElementById("ingredients"),m=document.getElementById("steps"),f=document.getElementById("mealType"),g=document.getElementById("addRecipeBtn"),v=document.getElementById("recipeList"),y=document.getElementById("filterIngredient"),h=document.getElementById("filterMealType"),w=document.getElementById("clearFilterBtn"),E=document.getElementById("send-btn"),b=document.getElementById("chat-input"),R=document.getElementById("chat-history"),L=document.getElementById("qr-btn"),I=document.getElementById("signOutBttn"),k=JSON.parse(localStorage.getItem("email"));async function B(){try{t=(await (0,d.getDoc)((0,d.doc)(d.db,"apikey","googlegenai"))).data().key,r=new s.GoogleGenerativeAI(t).getGenerativeModel({model:"gemini-1.5-flash"})}catch(t){throw e.error("Error fetching API key from Firestore: ",t),t}}async function F(t){if(!r)throw Error("Generative AI model not initialized. Please wait for page load.");try{return(await r.generateContent(`Provide a recipe suggestion or answer for: ${t}. If it's a recipe query, include name, ingredients, and steps.`)).response.text()}catch(t){throw e.error("Error in askChatBot:",t),t}}function $(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}async function x(t){try{let r=await (0,d.addDoc)((0,d.collection)(d.db,"recipes"),t);return e.info(`Recipe added successfully with ID: ${r.id}`),r}catch(t){throw e.error("Error adding recipe to Firestore: ",t),t}}async function C(t){let r=(0,d.doc)(d.db,"recipes",t);try{await (0,d.deleteDoc)(r),e.info(`Recipe with id ${t} has been deleted from Firestore.`),P(t)}catch(t){e.error("Error removing recipe: ",t),alert("Failed to delete recipe. Please try again.")}}function P(t){let r=document.getElementById(t);r?(r.remove(),e.info(`Recipe with id ${t} removed from the visual interface.`)):e.warn(`Recipe with id ${t} not found on the page.`)}function T(){let t=y.value.trim().toLowerCase(),r=h.value.toLowerCase();(0,d.getDocs)((0,d.collection)(d.db,"recipes")).then(e=>{v.innerHTML="",e.forEach(e=>{let i=e.data(),n=!t||i.ingredients.some(e=>e.toLowerCase().includes(t)),o=!r||i.mealType.toLowerCase()===r,a=i.email===k;n&&o&&a&&_(e.id,i)})}).catch(t=>{e.error("Error filtering recipes:",t),alert("Failed to filter recipes. Please try again.")})}async function H(){let e=await D();v.innerHTML="",e.forEach(e=>{_(e.id,e.data())})}function _(e,t){let r=document.createElement("li");r.id=e,r.tabIndex=0,r.innerHTML=`
    <span>${t.name} (${t.mealType})</span>
    <span class="actions">
      <button onclick="editRecipe('${e}', { name: prompt('New name:', '${t.name}'), mealType: prompt('New meal type:', '${t.mealType}') })">Edit</button>
      <button onclick="removeRecipe('${e}')">Delete</button>
      <button onclick="toggleFavorite('${e}', ${t.favorite||!1})">${t.favorite?"Unfavorite":"Favorite"}</button>
    </span>
  `,v.appendChild(r)}async function D(){let e=await (0,d.getDocs)((0,d.collection)(d.db,"recipes")),t=[];return e.forEach(e=>{e.data().email===k&&t.push(e)}),t}function M(e){let t=document.createElement("div");t.textContent=e,t.className="history",R.appendChild(t),b.value=""}k||(e.warn("No user email found in localStorage, redirecting to login"),window.location.href="index.html"),document.addEventListener("DOMContentLoaded",async()=>{await B(),e.info("API Key and Generative AI initialized."),H()}),g.addEventListener("click",async()=>{let t=p.value.trim(),r=u.value.trim(),i=m.value.trim(),n=f.value;if(t&&r&&i&&n){let o={name:$(t),ingredients:$(r).split(",").map(e=>e.trim()),steps:$(i).split("\n").map(e=>e.trim()).filter(e=>e),mealType:n,favorite:!1,email:k};try{await x(o),H(),p.value="",u.value="",m.value="",f.selectedIndex=0,alert("Recipe added successfully!"),e.info(`Recipe "${t}" added successfully by ${k}`)}catch(t){e.error("Error adding recipe:",t),alert("Failed to add recipe. Please try again.")}}else alert("Please fill in all recipe fields.")}),p.addEventListener("keypress",function(e){"Enter"===e.key&&g.click()}),w.addEventListener("click",()=>{y.value="",h.value="",H()}),y.addEventListener("input",T),h.addEventListener("change",T),window.editRecipe=function(t,r){let i=(0,d.doc)(d.db,"recipes",t);(0,d.updateDoc)(i,r).then(()=>{e.info(`Recipe with id ${t} updated successfully.`),H()}).catch(t=>{e.error("Error updating recipe:",t),alert("Failed to update recipe. Please try again.")})},window.removeRecipe=C,window.toggleFavorite=function(t,r){let i=(0,d.doc)(d.db,"recipes",t);(0,d.updateDoc)(i,{favorite:!r}).then(()=>{e.info(`Favorite status toggled for recipe with id ${t}.`),H()}).catch(t=>{e.error("Error toggling favorite:",t),alert("Failed to toggle favorite status. Please try again.")})},E.addEventListener("click",async()=>{let t=b.value.trim().toLowerCase();if(t)try{if(!function(e){if(e.startsWith("add recipe")){let t=e.replace("add recipe","").trim();return t?(x({name:t,ingredients:[],steps:[],mealType:"Dinner",favorite:!1,email:k}),M(`Recipe ${t} added!`),H()):M("Please specify a recipe name to add."),!0}if(e.startsWith("complete")){let t=e.replace("complete","").trim();return t?function(e){let t=v.getElementsByTagName("li"),r=!1;for(let i of t)i.querySelector("span:first-child").textContent.trim().split(" (")[0].toLowerCase()===e.toLowerCase()&&(C(i.id),P(i.id),r=!0);return r}(t)?(M(`Recipe ${t} marked as complete.`),H()):M("Recipe not found!"):M("Please specify a recipe to complete."),!0}if(e.startsWith("find recipes with")){var t;let r=e.replace("find recipes with","").trim();return r?(t=r,y.value=t,T(),M(`Finding recipes with ${r}...`)):M("Please specify an ingredient."),!0}return!1}(t)){let e=await F(t);M(e)}}catch(t){e.error("Error processing AI request:",t),M("Error: Could not process your request.")}else M("Please enter a prompt")}),L.addEventListener("click",()=>{window.open(`https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent("https://pei-tong.github.io/Recipe-Organizer-PWA/")}`,"_blank")||alert("Please allow popups to generate QR code.")}),I.addEventListener("click",()=>{localStorage.removeItem("email"),e.info("User signed out"),window.location.href="index.html"});
//# sourceMappingURL=recipes.e7672a28.js.map
